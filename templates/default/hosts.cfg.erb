# Host definitions
#
# Autogenerated by Chef.

define host {
  use server
  address <%= node['ipaddress'] %>
  display_name <%= node['nagios']['server_role'] %>
  host_name <%= node['hostname']%> - <%= node['ipaddress'] %>
  ;hostgroups <%= node['nagios']['server_role'] %>,<%= node['os'] %>
  hostgroups <%= node['nagios']['server_role'] %>
  alias Role: <%= node['nagios']['server_role'] %>  --   Instance ID: <%= node['ec2']['instance_id'] %>  --   Zone: <%= node['ec2']['placement_availability_zone'] %>  --   App Environment: <%= node['app_environment'] %>  --   Platform: <%= node['platform'] %>,<%= node['platform_version'] %>  --   Public IP(if applicable): <%= node['ec2']['public_ipv4'] %>  --  Private IP: <%= node['ipaddress'] %>  --   FQDN(if applicable): <%= node['fqdn'] %>\n
  
}

<% @nodes.each do |n| -%>
<% unless n.name == node.name -%>
define host {
  use server
  address <%= n['ipaddress'] %>
  display_name <%= n.run_list.roles.last %>
  host_name <%= n['hostname'] %> - <%= n['ipaddress'] %>
  notes $HOSTDISPLAYNAME$
  alias Role: <%= n.run_list.roles.last %>  --   Instance ID: <%= n['ec2']['instance_id'] %>  --  Zone: <%= n['ec2']['placement_availability_zone'] %>  --  App Environment: <%= n['app_environment'] %>  --   Platform: <%= n['platform'] %>,<%= n['platform_version'] %>  --  Public IP(if applicable): <%= n['ec2']['public_ipv4'] %>  --   Private IP: <%= n['ipaddress'] %>  --   FQDN(if applicable): <%= n['fqdn'] %>  --   Component(if applicable): <%= n['component'] %>\n


<% if n.run_list.roles.nil? || n.run_list.roles.length == 0 -%>
    ;hostgroups all,<%= n.os %>
    hostgroups all
  <% else -%>
    ;hostgroups <%= n.run_list.roles.to_a.join(",") %>,<%= n['os'] %>
    hostgroups <%= n.run_list.roles.to_a.join(",") %>
  <% end -%>
  }
  <% end -%>

  <% end -%>
